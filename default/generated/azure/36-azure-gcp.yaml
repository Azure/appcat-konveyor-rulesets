- category: mandatory
  customVariables: []
  description: Google Cloud Pub/Sub usage detected
  effort: 3
  labels:
  - source=google-pubsub
  - target=azure-appservice
  - target=azure-aks
  - target=azure-container-apps
  - domain=cloud-readiness
  - category=messaging
  - os=windows
  - os=linux
  links:
  - title: Azure for Google Cloud Professionals
    url: https://learn.microsoft.com/en-us/azure/architecture/gcp-professional/services#messaging-and-eventing
  - title: Azure Service Bus Java samples
    url: https://learn.microsoft.com/en-us/azure/service-bus-messaging/service-bus-samples
  message: |-
    The application uses Google Cloud Pub/Sub client libraries.

    To align with Azure messaging services:
      1. Review messaging requirements and choose the appropriate Azure service (Service Bus, Event Grid, or Event Hubs).
      2. Replace Google Pub/Sub clients with the corresponding Azure SDKs.
      3. Update configuration to use Azure credentials and connection information.
      4. Verify message publishing and subscription flows with integration tests.
  ruleID: google-pubsub-to-azure-service-bus-01000
  when:
    or:
    - java.referenced:
        location: IMPORT
        pattern: com.google.cloud.pubsub.v1*
    - java.dependency:
        lowerbound: 0.0.0
        name: com.google.cloud:google-cloud-pubsub
    - java.dependency:
        lowerbound: 0.0.0
        nameregex: com\.google\.cloud\.[a-z0-9_.-]*pubsub[a-z0-9_.-]*
- category: mandatory
  customVariables: []
  description: Google Container Registry (GCR) or Artifact Registry usage detected
  effort: 3
  labels:
  - source=google-gcr
  - target=azure-aks
  - target=azure-container-apps
  - domain=cloud-readiness
  - category=container-registry
  - os=windows
  - os=linux
  links:
  - title: Azure Container Registry documentation
    url: https://learn.microsoft.com/en-us/azure/container-registry/
  - title: Migrate from Google Container Registry to Azure Container Registry
    url: https://learn.microsoft.com/en-us/azure/container-registry/container-registry-import-images
  - title: Azure Container Registry best practices
    url: https://learn.microsoft.com/en-us/azure/container-registry/container-registry-best-practices
  message: |-
    The application uses Google Container Registry (gcr.io) or Google Artifact Registry ([location]-docker.pkg.dev) for container images.

    **Common patterns detected may include:**
    * Container image references in Dockerfiles and docker-compose files
    * Kubernetes manifests (Deployments, StatefulSets, DaemonSets, Jobs, CronJobs, Pods) with GCR images
    * Configuration files referencing GCR endpoints

    **To migrate to Azure Container Registry (ACR):**

    1. **Provision Azure Container Registry:**
       * Create an ACR instance: `az acr create --name <registry-name> --resource-group <rg> --sku Standard`

    2. **Migrate container images:**
       * Import images from GCR: `az acr import --name <acr-name> --source gcr.io/<project>/<image>:<tag> --image <image>:<tag>`
       * Or use docker pull/push: `docker pull gcr.io/<project>/<image>` then `docker push <acr-name>.azurecr.io/<image>`

    3. **Update image references:**
       * Replace `gcr.io/<project>/<image>` with `<acr-name>.azurecr.io/<image>`
       * Replace `<location>-docker.pkg.dev/<project>/<repo>/<image>` with `<acr-name>.azurecr.io/<image>`
       * Update all Dockerfiles, docker-compose files, Kubernetes manifests, and Helm charts

    4. **Configure authentication:**
       * **For AKS (recommended):** Enable managed identity integration: `az aks update --name <aks-cluster> --attach-acr <acr-name>`
       * **For other services:** Use Azure managed identities or service principals
       * **For local development:** Use `az acr login --name <acr-name>`

    5. **Remove GCR-specific tooling:**
       * Replace gcloud docker authentication with Azure CLI or service principals

    6. **For language packages (if using Artifact Registry for npm/Maven/Python):**
       * Use Azure Artifacts for package management instead of Google Artifact Registry
  ruleID: google-gcr-to-azure-acr-01000
  when:
    or:
    - builtin.filecontent:
        filePattern: (?i)(dockerfile|\.dockerignore|docker-compose\.ya?ml|.*\.ya?ml|.*\.json|\.properties|pom\.xml|build\.gradle|package\.json|requirements\.txt|\.npmrc|\.pypirc|Makefile|.*\.sh|.*\.ps1)$
        pattern: (gcr\.io|[a-z]+-docker\.pkg\.dev)