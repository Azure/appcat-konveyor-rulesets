- category: mandatory
  customVariables: []
  description: Google Cloud Pub/Sub usage detected
  effort: 3
  labels:
  - source=google-cloud-pubsub
  - target=azure-appservice
  - target=azure-aks
  - target=azure-container-apps
  - domain=cloud-readiness
  - category=messaging-service-migration
  - os=windows
  - os=linux
  links:
  - title: Use the Azure portal to create a Service Bus topic and subscriptions to the topic
    url: https://learn.microsoft.com/en-us/azure/service-bus-messaging/service-bus-quickstart-topics-subscriptions-portal
  - title: Get started with Service Bus topics and subscriptions (Java)
    url: https://learn.microsoft.com/azure/service-bus-messaging/service-bus-java-how-to-use-topics-subscriptions
  - title: Azure Service Bus client library for Java (azure-messaging-servicebus)
    url: https://learn.microsoft.com/java/api/overview/azure/messaging-servicebus-readme
  - title: Messaging services on Azure and AWS
    url: https://learn.microsoft.com/en-us/azure/architecture/aws-professional/messaging
  message: |-
    The application uses Google Cloud Pub/Sub for pub/sub messaging. Consider migrating to Azure Service Bus Topics.
    Azure Service Bus Topics and Subscriptions provide durable pub/sub messaging with at-least-once delivery, filtering, and dead-lettering.
    You will need to replace Google Cloud Pub/Sub client usage (publish/subscribe, subscription administration, authentication and configuration) with Azure Service Bus topic/subscription entities and the Azure Service Bus SDK (or an appropriate framework integration).
  ruleID: google-pubsub-to-azure-service-bus-01000
  when:
    or:
    - java.dependency:
        name: com.google.cloud.google-cloud-pubsub
    - java.dependency:
        name: com.google.cloud.spring-cloud-gcp-starter-pubsub
    - java.dependency:
        name: org.springframework.cloud.spring-cloud-gcp-pubsub
    - java.dependency:
        name: com.google.cloud.spring-cloud-gcp-pubsub
    - java.dependency:
        nameregex: com.google.api.grpc.grpc-google-cloud-pubsub-v1
- category: mandatory
  customVariables: []
  description: Google Container Registry (GCR) or Artifact Registry usage detected
  effort: 3
  labels:
  - source=google-gcr
  - target=azure-aks
  - target=azure-container-apps
  - domain=cloud-readiness
  - category=container-registry
  - os=windows
  - os=linux
  links:
  - title: Azure Container Registry documentation
    url: https://learn.microsoft.com/en-us/azure/container-registry/
  - title: Migrate from Google Container Registry to Azure Container Registry
    url: https://learn.microsoft.com/en-us/azure/container-registry/container-registry-import-images
  - title: Azure Container Registry best practices
    url: https://learn.microsoft.com/en-us/azure/container-registry/container-registry-best-practices
  message: |-
    The application uses Google Container Registry (gcr.io) or Google Artifact Registry ([location]-docker.pkg.dev) for container images.

    **Common patterns detected may include:**
    * Container image references in Dockerfiles and docker-compose files
    * Kubernetes manifests (Deployments, StatefulSets, DaemonSets, Jobs, CronJobs, Pods) with GCR images
    * Configuration files referencing GCR endpoints

    **To migrate to Azure Container Registry (ACR):**
    * **Provision Azure Container Registry:**
       * Create an ACR instance: `az acr create --name <registry-name> --resource-group <rg> --sku Standard`
    * **Migrate container images:**
       * Import images from GCR: `az acr import --name <acr-name> --source gcr.io/<project>/<image>:<tag> --image <image>:<tag>`
       * Or use docker pull/push: `docker pull gcr.io/<project>/<image>` then `docker push <acr-name>.azurecr.io/<image>`
    * **Update image references:**
       * Replace `gcr.io/<project>/<image>` with `<acr-name>.azurecr.io/<image>`
       * Replace `<location>-docker.pkg.dev/<project>/<repo>/<image>` with `<acr-name>.azurecr.io/<image>`
       * Update all Dockerfiles, docker-compose files, Kubernetes manifests, and Helm charts
    * **Configure authentication:**
       * **For AKS (recommended):** Enable managed identity integration: `az aks update --name <aks-cluster> --attach-acr <acr-name>`
       * **For other services:** Use Azure managed identities or service principals
       * **For local development:** Use `az acr login --name <acr-name>`
    * **Remove GCR-specific tooling:**
       * Replace gcloud docker authentication with Azure CLI or service principals
    * **For language packages (if using Artifact Registry for npm/Maven/Python):**
       * Use Azure Artifacts for package management instead of Google Artifact Registry
  ruleID: google-gcr-to-azure-acr-01000
  when:
    or:
    - builtin.filecontent:
        filePattern: (?i)(dockerfile|\.dockerignore|docker-compose\.ya?ml|.*\.ya?ml|.*\.json|\.properties|pom\.xml|build\.gradle|package\.json|requirements\.txt|\.npmrc|\.pypirc|Makefile|.*\.sh|.*\.ps1)$
        pattern: (gcr\.io|[a-z]+-docker\.pkg\.dev)